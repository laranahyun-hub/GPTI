<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>â—‹â–³â–¡S ë„í˜• í…ŒìŠ¤íŠ¸</title>
<style>
  :root{
    --bg:#fbf6f4;
    --title:#3c2f91;
    --frame:#b9764f;
    --accent:#3c2f91;
    --btn-border:#e6e6e6;
  }
  html,body{height:100%;margin:0}
  body{
    font-family:"Pretendard","Noto Sans KR",system-ui,-apple-system,Arial;
    background:var(--bg);color:#222;
    display:flex;flex-direction:column;align-items:center;
    padding:20px 16px 40px;
  }
  h1{color:var(--title);font-size:34px;margin:8px 0 6px;letter-spacing:2px}
  .subtitle{color:var(--title);text-align:center;font-size:14px;margin:0 0 18px}
  
  #captureArea {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
  }

  .board-wrap{position:relative;width:420px;max-width:92vw}
  #board{
    width:360px;height:360px;margin:0 auto;
    background:#fff;border:4px solid var(--frame);box-sizing:border-box;position:relative;
    touch-action:none; 
  }
  #inner{
    position:absolute;width:180px;height:180px;left:50%;top:50%;
    transform:translate(-50%,-50%);
    border:4px dashed rgba(183,132,112,0.35);pointer-events:none;
  }
  .tools{display:flex;gap:12px;justify-content:center;margin-top:18px;flex-wrap:wrap}
  .tool{width:64px;height:64px;border-radius:14px;border:2px solid var(--btn-border);
    display:flex;align-items:center;justify-content:center;background:#fff;
    font-size:28px;cursor:pointer;box-shadow:0 6px 20px rgba(60,47,145,0.06);
    transition:transform .12s,background .12s,border-color .12s}
  .tool.active{background:#efeefc;border-color:var(--accent);box-shadow:0 10px 26px rgba(60,47,145,0.14)}
  .actions{display:flex;gap:12px;justify-content:center;margin-top:12px;flex-wrap:wrap}
  .btn{padding:10px 16px;border-radius:10px;border:1px solid var(--btn-border);
    background:#fff;color:var(--accent);font-weight:600;cursor:pointer;}
  .btn.primary{background:var(--accent);color:#fff;border:none;box-shadow:0 6px 18px rgba(60,47,145,0.16)}
  .placed{position:absolute;user-select:none;display:flex;align-items:center;justify-content:center;
    box-sizing:border-box;border-radius:8px;transform-origin:center center;
    touch-action: none;
  }
  .placed svg { width: 100%; height: 100%; }
  .placed .badge{position:absolute;right:4px;bottom:4px;background:var(--accent);color:#fff;font-size:11px;padding:2px 6px;border-radius:8px;z-index: 1;}
  .handle{position:absolute;width:16px;height:16px;right:-8px;bottom:-8px;background:#fff;border:2px solid var(--accent);border-radius:6px;box-shadow:0 4px 10px rgba(0,0,0,0.08);touch-action:none;cursor:se-resize;}
  .rotate-handle{position:absolute;width:14px;height:14px;top:-24px;left:50%;transform:translateX(-50%);background:#fff;border:2px solid var(--accent);border-radius:50%;cursor:grab;touch-action:none;}
  
  #resultBox{width:420px;max-width:92vw;margin:18px auto 0;text-align:left}
  .card{background:#fff;padding:14px;border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,0.06)}
  .card h3{margin:0 0 8px;color:var(--accent)}
  .line{margin:8px 0;color:#222;line-height:1.6}
  .scent{margin-top:8px;color:#4b4b4b;font-weight:600}
  @media(max-width:420px){
    #board{width:320px;height:320px}
    #inner{width:160px;height:160px}
    .tool{width:56px;height:56px;font-size:24px}
    #resultBox{width:320px} 
  }
</style>
</head>
<body>

<h1>â—‹â–³â–¡S ë„í˜• í…ŒìŠ¤íŠ¸</h1>
<div class="subtitle">ê°€ì¥ ë§ˆìŒì— ë“œëŠ” ë„í˜•ì„ 3ë²ˆ, ë‚˜ë¨¸ì§€ë¥¼ ê°ê° 1ë²ˆì”© ë°°ì¹˜í•˜ì„¸ìš”.</div>

<div id="captureArea">
  <div class="board-wrap">
    <div id="board"><div id="inner"></div></div>
  </div>

  <div class="tools">
    <div class="tool active" data-shape="circle">â—‹</div>
    <div class="tool" data-shape="triangle">â–³</div>
    <div class="tool" data-shape="square">â–¡</div>
    <div class="tool" data-shape="wave">S</div>
  </div>

  <div class="actions">
    <button id="undo" class="btn">Undo</button>
    <button id="reset" class="btn">ì´ˆê¸°í™”</button>
    <button id="analyze" class="btn primary">ê²°ê³¼ ë³´ê¸°</button>
  </div>

  <div id="resultBox">
    <div class="card">
      <h3>ê²€ì‚¬ ê²°ê³¼</h3>
      <div id="resultContent">
        <div class="line">ë„í˜•ì„ ë°°ì¹˜í•œ ë’¤ 'ê²°ê³¼ ë³´ê¸°'ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
      </div>
    </div>
  </div>
</div>

<div class="actions" style="margin-top:20px;">
  <button id="savePDF" class="btn">ğŸ“„ ê²°ê³¼ PDF ì €ì¥</button>
</div>

<!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// ê¸°ë³¸ ë³€ìˆ˜
const board=document.getElementById('board');
const tools=document.querySelectorAll('.tool');
let currentTool='circle', placed=[], orderCounter=0;
const resultContent=document.getElementById('resultContent');

// ë„í˜• ì„ íƒ
tools.forEach(t=>{
  t.addEventListener('click',()=>{
    tools.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    currentTool=t.dataset.shape;
  });
});

// ë„í˜• ìƒì„±
board.addEventListener('pointerdown',ev=>{
  if(ev.target!==board)return;
  if(placed.length>=6){alert('ìµœëŒ€ 6ê°œê¹Œì§€ë§Œ ë°°ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');return;}
  const rect=board.getBoundingClientRect();
  addPlaced(currentTool,ev.clientX-rect.left,ev.clientY-rect.top,60);
});

function addPlaced(type,x,y,size){
  orderCounter++;
  const el=document.createElement('div');
  el.className='placed';
  el.style.left=(x-size/2)+'px';
  el.style.top=(y-size/2)+'px';
  el.style.width=size+'px';
  el.style.height=size+'px';
  el.dataset.type=type;
  el.style.zIndex=100+orderCounter;
  el.dataset.rotate=0;
  const rec={el,type,left:x-size/2,top:y-size/2,size,rotate:0,sTextElement:null};

  if(type==='circle')
    el.innerHTML=`<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="42" stroke="#3c2f91" stroke-width="6" fill="none"/></svg><div class="badge">${orderCounter}</div>`;
  else if(type==='triangle')
    el.innerHTML=`<svg viewBox="0 0 100 100"><polygon points="50,8 8,92 92,92" stroke="#3c2f91" stroke-width="6" fill="none"/></svg><div class="badge">${orderCounter}</div>`;
  else if(type==='square')
    el.innerHTML=`<svg viewBox="0 0 100 100"><rect x="8" y="8" width="84" height="84" stroke="#3c2f91" stroke-width="6" fill="none"/></svg><div class="badge">${orderCounter}</div>`;
  else {
    const sText=document.createElement('div');
    sText.style.fontSize=size*0.9+'px';
    sText.style.color='#3c2f91';
    sText.style.fontWeight='700';
    sText.textContent='S';
    el.appendChild(sText);
    el.innerHTML+=`<div class="badge">${orderCounter}</div>`;
    rec.sTextElement=sText;
  }

  const handle=document.createElement('div');handle.className='handle';
  const rot=document.createElement('div');rot.className='rotate-handle';
  el.appendChild(handle);
  el.appendChild(rot);
  board.appendChild(el);
  placed.push(rec);
  makeInteractive(el,handle,rot,rec);
}

// ë„í˜• ì´ë™/í¬ê¸°ì¡°ì ˆ/íšŒì „
function makeInteractive(el,handle,rot,rec){
  // ì´ë™
  el.addEventListener('pointerdown',ev=>{
    if(ev.target===handle||ev.target===rot)return;
    const startX=ev.clientX,startY=ev.clientY;
    const startLeft=parseFloat(el.style.left),startTop=parseFloat(el.style.top);
    function move(mv){
      const nx=Math.max(0,Math.min(board.clientWidth-rec.size,startLeft+(mv.clientX-startX)));
      const ny=Math.max(0,Math.min(board.clientHeight-rec.size,startTop+(mv.clientY-startY)));
      el.style.left=nx+'px';el.style.top=ny+'px';rec.left=nx;rec.top=ny;
    }
    function up(){window.removeEventListener('pointermove',move);window.removeEventListener('pointerup',up);}
    window.addEventListener('pointermove',move);window.addEventListener('pointerup',up);
  });
  // í¬ê¸° ì¡°ì ˆ
  handle.addEventListener('pointerdown',ev=>{
    ev.stopPropagation();
    const startX=ev.clientX,startY=ev.clientY,startSize=rec.size;
    function move(mv){
      const dx=mv.clientX-startX,dy=mv.clientY-startY;
      const d=Math.abs(dx)>Math.abs(dy)?dx:dy;
      const newSize=Math.max(20,Math.min(200,Math.round(startSize+d)));
      rec.size=newSize;el.style.width=newSize+'px';el.style.height=newSize+'px';
      if(rec.type==='wave'&&rec.sTextElement){rec.sTextElement.style.fontSize=newSize*0.9+'px';}
    }
    function up(){window.removeEventListener('pointermove',move);window.removeEventListener('pointerup',up);}
    window.addEventListener('pointermove',move);window.addEventListener('pointerup',up);
  });
  // íšŒì „
  rot.addEventListener('pointerdown',ev=>{
    ev.stopPropagation();
    const rect=el.getBoundingClientRect();
    const cx=rect.left+rect.width/2,cy=rect.top+rect.height/2;
    function move(mv){
      const angle=Math.atan2(mv.clientY-cy,mv.clientX-cx)*180/Math.PI;
      rec.rotate=angle;el.style.transform=`rotate(${angle}deg)`;
    }
    function up(){window.removeEventListener('pointermove',move);window.removeEventListener('pointerup',up);}
    window.addEventListener('pointermove',move);window.addEventListener('pointerup',up);
  });
}

// ê²°ê³¼ í•´ì„
document.getElementById('analyze').onclick=()=>{
  if(placed.length<4){alert('ëª¨ë“  ë„í˜•ì„ ë°°ì¹˜í•œ ë’¤ ì‹¤í–‰í•˜ì„¸ìš”.');return;}
  resultContent.innerHTML=`<div class="line">ë„í˜•ì„ ë°°ì¹˜í•˜ì‹  ì„±í–¥ì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>`;
  setTimeout(()=>{resultContent.innerHTML=`<div class="line">[ì˜ˆì‹œ] ì¡°í™”í˜• / ì°½ì˜í˜• ë“± ë¶„ì„ ê²°ê³¼ ì¶œë ¥ë©ë‹ˆë‹¤.</div>`},500);
};

// PDF ì €ì¥
document.getElementById('savePDF').addEventListener('click',()=>{
  const captureTarget=document.getElementById('captureArea');
  html2canvas(captureTarget,{scale:3,useCORS:true}).then(canvas=>{
    const imgData=canvas.toDataURL('image/png');
    const{jsPDF}=window.jspdf;
    const pdf=new jsPDF('p','mm','a4');
    const pdfWidth=210;
    const imgWidth=pdfWidth-20;
    const imgHeight=canvas.height*imgWidth/canvas.width;
    pdf.addImage(imgData,'PNG',10,10,imgWidth,imgHeight);
    pdf.save('ë„í˜•ì‹¬ë¦¬í…ŒìŠ¤íŠ¸_ê²°ê³¼.pdf');
  });
});
</script>
</body>
</html>